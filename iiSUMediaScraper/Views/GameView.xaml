<?xml version="1.0" encoding="utf-8"?>
<UserControl x:Class="iiSUMediaScraper.Views.GameView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="using:iiSUMediaScraper.Views"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:media="using:CommunityToolkit.WinUI.Media"
             xmlns:ui="using:CommunityToolkit.WinUI"
             xmlns:controls="using:CommunityToolkit.WinUI.Controls"
             xmlns:configurationmodels="using:iiSUMediaScraper.Models.Configurations"
             xmlns:configurationviewmodels="using:iiSUMediaScraper.ViewModels.Configurations"
             xmlns:controls1="using:iiSUMediaScraper.Controls"
             xmlns:converters="using:CommunityToolkit.WinUI.Converters"
             xmlns:customconverters="using:iiSUMediaScraper.Converters"
             xmlns:datatemplateselectors="using:iiSUMediaScraper.DataTemplateSelectors"
             xmlns:viewmodels="using:iiSUMediaScraper.ViewModels"
             mc:Ignorable="d">

    <UserControl.Resources>
        <media:AttachedCardShadow x:Key="CommonShadow"
                                  Offset="0,2"
                                  BlurRadius="12"
                                  Opacity=".3"
                                  CornerRadius="8" />

        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />

        <customconverters:PathToValidImagePathConverter x:Key="PathToValidImagePathConverter" />

        <customconverters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />

        <customconverters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" />

        <customconverters:BoolNegationConverter x:Key="BoolNegationConverter" />

        <customconverters:BoolToIntegerConverter x:Key="BoolToIntegerConverter"
                                                 FalseValue="0"
                                                 TrueValue="2" />

        <customconverters:BoolToThicknessConverter x:Key="BoolToThicknessConverter"
                                                   FalseValue="0"
                                                   TrueValue="2" />

        <customconverters:GreaterThanIntegerToVisibilityConverter x:Key="GreaterThanOneToVisibilityConverter"
                                                                  GreaterThan="1" />

        <DataTemplate x:Key="ImageViewModelTemplate"
                      x:DataType="viewmodels:ImageViewModel">
            <local:ImageView ViewModel="{x:Bind Mode=OneWay}" />
        </DataTemplate>

        <DataTemplate x:Key="VideoViewModelTemplate"
                      x:DataType="viewmodels:VideoViewModel">
            <Grid>

            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="MediaViewModelTemplate"
                      x:DataType="viewmodels:VideoViewModel">
            <Grid>

            </Grid>
        </DataTemplate>

        <datatemplateselectors:MeadiaTemplateSelector x:Key="MeadiaTemplateSelector"
                                                      ImageTemplate="{StaticResource ImageViewModelTemplate}"
                                                      VideoTemplate="{StaticResource VideoViewModelTemplate}"
                                                      MediaTemplate="{StaticResource MediaViewModelTemplate}" />
    </UserControl.Resources>

    <Border ui:Effects.Shadow="{StaticResource CommonShadow}">
        <Grid BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
              BorderThickness="1"
              Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
              CornerRadius="8"
              Padding="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="auto" />
            </Grid.RowDefinitions>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="auto" />
                </Grid.ColumnDefinitions>
                <StackPanel Margin="0,0,0,16">
                    <TextBlock Text="{x:Bind ViewModel.Name, Mode=OneWay}"
                               FontSize="16"
                               VerticalAlignment="Center"
                               Grid.Column="1"
                               Margin="0,0,16,0" />
                    <TextBlock Text="{x:Bind ViewModel.Path, Mode=OneWay}"
                               FontSize="13"
                               Foreground="{ThemeResource TextFillColorSecondary}"
                               VerticalAlignment="Center"
                               Grid.Column="1"
                               Margin="0,0,16,0" />
                </StackPanel>
                <StackPanel Orientation="Horizontal"
                            Grid.Column="1">
                    <InfoBar Severity="Error"
                             Message="Missing Media"
                             IsOpen="True"
                             IsClosable="False"
                             Margin="0,0,16,0"
                             Visibility="{x:Bind ViewModel.IsFound, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}" />
                    <Button Visibility="{x:Bind ViewModel.IsInDemoMode, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                            Padding="6"
                            Height="36"
                            Margin="0,0,16,0"
                            VerticalAlignment="Top">
                        <SymbolIcon Symbol="Add" />
                        <Button.Flyout>
                            <Flyout>
                                <StackPanel>
                                    <MenuFlyoutItem Text="Icons"
                                                    Click="MenuFlyoutItem_AddIconsClick"
                                                    MinWidth="160" />
                                    <MenuFlyoutItem Text="Titles"
                                                    Click="MenuFlyoutItem_AddTitlesClick"
                                                    MinWidth="160" />
                                    <MenuFlyoutItem Text="Logos"
                                                    Click="MenuFlyoutItem_AddSlidesClick"
                                                    MinWidth="160" />
                                    <MenuFlyoutItem Text="Slides"
                                                    Click="MenuFlyoutItem_AddLogosClick"
                                                    MinWidth="160" />
                                    <MenuFlyoutItem Text="Heros"
                                                    Click="MenuFlyoutItem_AddHerosClick"
                                                    MinWidth="160" />
                                </StackPanel>
                            </Flyout>
                        </Button.Flyout>
                    </Button>
                    <ToggleButton IsChecked="{x:Bind ViewModel.IsInDemoMode, Mode=TwoWay}"
                                  Padding="6"
                                  Height="36"
                                  VerticalAlignment="Top"
                                  ToolTipService.ToolTip="Toggle Demo Mode">
                        <SymbolIcon Symbol="DockBottom" />
                    </ToggleButton>
                </StackPanel>
            </Grid>
            <Grid Grid.Row="1"
                  Visibility="{x:Bind ViewModel.IsInDemoMode, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                  MinHeight="462"
                  MaxWidth="600"
                  Margin="32,16">
                <Grid Background="{ThemeResource LayerFillColorAltBrush}"
                      BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                      BorderThickness="1"
                      CornerRadius="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="6" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <Border Margin="16,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Stretch"
                            Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}, FallbackValue='Collapsed'}">
                        <Image Stretch="UniformToFill"
                               Visibility="{x:Bind CurrentHero, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}, FallbackValue='Collapsed'}"
                               Source="{x:Bind CurrentHero.Bytes, Mode=OneWay, Converter={StaticResource PathToValidImagePathConverter}}" />
                    </Border>
                    <Border Background="{ThemeResource SmokeFillColorDefaultBrush}"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            MinHeight="320" />
                    <InfoBadge Value="{x:Bind ViewModel.DemoModeHeros.Count, Mode=OneWay}"
                               VerticalAlignment="Top"
                               HorizontalAlignment="Left"
                               Visibility="{x:Bind HeroCount, Mode=OneWay, Converter={StaticResource GreaterThanOneToVisibilityConverter}}"
                               ToolTipService.ToolTip="There are multiple heros. They will cycle every 5 seconds"
                               Margin="8" />
                    <Border VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Width="240"
                            Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}, FallbackValue='Collapsed'}">
                        <Image Stretch="Uniform"
                               Visibility="{x:Bind ViewModel.DemoModeTitle, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}, FallbackValue='Collapsed'}"
                               Source="{x:Bind ViewModel.DemoModeTitle.Bytes, Mode=OneWay, Converter={StaticResource PathToValidImagePathConverter}}" />
                    </Border>
                    <Border Margin="32,16"
                            Width="140"
                            Height="100"
                            VerticalAlignment="Bottom"
                            HorizontalAlignment="Left"
                            Visibility="{x:Bind CurrentSlide, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                        <Border Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}, FallbackValue='Collapsed'}">
                            <Image Stretch="Uniform"
                                   Visibility="{x:Bind CurrentSlide, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}, FallbackValue='Collapsed'}"
                                   Source="{x:Bind CurrentSlide.Bytes, Mode=OneWay, Converter={StaticResource PathToValidImagePathConverter}}" />
                        </Border>
                    </Border>
                    <InfoBadge Value="{x:Bind SlideCount, Mode=OneWay}"
                               VerticalAlignment="Bottom"
                               HorizontalAlignment="Left"
                               Visibility="{x:Bind ViewModel.DemoModeSlides.Count, Mode=OneWay, Converter={StaticResource GreaterThanOneToVisibilityConverter}}"
                               Margin="168,0,0, 110"
                               ToolTipService.ToolTip="There are multiple slides. They will cycle every 5 seconds" />
                    <Border BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="0,6,0,0"
                            VerticalAlignment="Center"
                            Grid.Row="1" />
                    <Grid Grid.Row="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="140" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="140" />
                        </Grid.ColumnDefinitions>
                        <Grid>
                            <Border Background="{ThemeResource AccentAAFillColorDefaultBrush}"
                                    Height="80"
                                    Width="80"
                                    CornerRadius="40"
                                    VerticalAlignment="Top"
                                    Margin="0,32,0,0" />
                            <Grid VerticalAlignment="Bottom">
                                <Border Background="{ThemeResource AccentAAFillColorDefaultBrush}"
                                        Height="30"
                                        Width="80"
                                        CornerRadius="8"
                                        VerticalAlignment="Center"
                                        Margin="0,0,0,32" />
                                <Border Background="{ThemeResource AccentAAFillColorDefaultBrush}"
                                        Height="80"
                                        Width="30"
                                        CornerRadius="8"
                                        VerticalAlignment="Center"
                                        Margin="0,0,0,32" />
                            </Grid>
                        </Grid>
                        <Border Background="{ThemeResource LayerFillColorAltBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                Grid.Column="1"
                                CornerRadius="8"
                                Margin="16"
                                Height="240"
                                HorizontalAlignment="Stretch">
                            <Border Height="200"
                                    Width="200"
                                    Margin="16"
                                    Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}, FallbackValue='Collapsed'}">
                                <Image Stretch="Uniform"
                                       Visibility="{x:Bind ViewModel.DemoModeIcon, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}, FallbackValue='Collapsed'}"
                                       Source="{x:Bind ViewModel.DemoModeIcon.Bytes, Mode=OneWay, Converter={StaticResource PathToValidImagePathConverter}}" />
                            </Border>
                        </Border>
                        <Grid Grid.Column="2">
                            <Border VerticalAlignment="Bottom"
                                    Background="{ThemeResource AccentAAFillColorDefaultBrush}"
                                    Height="80"
                                    Width="80"
                                    CornerRadius="40"
                                    Margin="0,0,0,32" />
                            <Grid VerticalAlignment="Top"
                                  Margin="0,32,0,0"
                                  Height="80"
                                  Width="80">
                                <Border Background="{ThemeResource AccentAAFillColorDefaultBrush}"
                                        Height="30"
                                        Width="30"
                                        CornerRadius="15"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Center" />
                                <Border Background="{ThemeResource AccentAAFillColorDefaultBrush}"
                                        Height="30"
                                        Width="30"
                                        CornerRadius="15"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center" />
                                <Border Background="{ThemeResource AccentAAFillColorDefaultBrush}"
                                        Height="30"
                                        Width="30"
                                        CornerRadius="15"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Top" />
                                <Border Background="{ThemeResource AccentAAFillColorDefaultBrush}"
                                        Height="30"
                                        Width="30"
                                        CornerRadius="15"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Bottom" />
                            </Grid>
                        </Grid>
                    </Grid>
                </Grid>
                <controls:Shimmer Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                  CornerRadius="8" />
            </Grid>
            <StackPanel Grid.Row="1"
                        Visibility="{x:Bind ViewModel.IsInDemoMode, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="16" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <StackPanel>
                        <TextBlock Text="Icons"
                                   Margin="0,0,0,8" />
                        <Grid Margin="0,0,0,8">
                            <controls:Shimmer MinHeight="168"
                                              Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
                            <controls1:DropZone Padding="16"
                                                MinHeight="168"
                                                DropMessage="Drop Images"
                                                AcceptedExtensions="png, jpg, jpeg, gif, webp"
                                                FilesDropped="DropZone_IconFilesDropped"
                                                Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                                <ScrollView>
                                    <ItemsRepeater ItemsSource="{x:Bind ViewModel.MediaContext.Icons, Mode=OneWay}"
                                                   ItemTemplate="{StaticResource MeadiaTemplateSelector}">
                                        <ItemsRepeater.Layout>
                                            <StackLayout Spacing="16"
                                                         Orientation="Horizontal" />
                                        </ItemsRepeater.Layout>
                                    </ItemsRepeater>
                                </ScrollView>
                            </controls1:DropZone>
                        </Grid>
                    </StackPanel>
                    <StackPanel Grid.Column="2">
                        <TextBlock Text="Titles"
                                   Margin="0,0,0,8" />
                        <Grid Margin="0,0,0,8">
                            <controls:Shimmer MinHeight="168"
                                              Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
                            <controls1:DropZone Padding="16"
                                                MinHeight="168"
                                                DropMessage="Drop Images"
                                                AcceptedExtensions="png, jpg, jpeg, gif, webp"
                                                FilesDropped="DropZone_TitleFilesDropped"
                                                Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                                <ScrollView>
                                    <ItemsRepeater ItemsSource="{x:Bind ViewModel.MediaContext.Titles, Mode=OneWay}"
                                                   ItemTemplate="{StaticResource MeadiaTemplateSelector}">
                                        <ItemsRepeater.Layout>
                                            <StackLayout Spacing="16"
                                                         Orientation="Horizontal" />
                                        </ItemsRepeater.Layout>
                                    </ItemsRepeater>
                                </ScrollView>
                            </controls1:DropZone>
                        </Grid>
                    </StackPanel>
                </Grid>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="16" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <StackPanel>
                        <TextBlock Text="Slides"
                                   Margin="0,0,0,8" />
                        <Grid Margin="0,0,0,8">
                            <controls:Shimmer MinHeight="168"
                                              Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
                            <controls1:DropZone Padding="16"
                                                MinHeight="168"
                                                DropMessage="Drop Images"
                                                AcceptedExtensions="png, jpg, jpeg, gif, webp"
                                                FilesDropped="DropZone_SlideFilesDropped"
                                                Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                                <ScrollView>
                                    <ItemsRepeater ItemsSource="{x:Bind ViewModel.MediaContext.Slides, Mode=OneWay}"
                                                   ItemTemplate="{StaticResource MeadiaTemplateSelector}">
                                        <ItemsRepeater.Layout>
                                            <StackLayout Spacing="16"
                                                         Orientation="Horizontal" />
                                        </ItemsRepeater.Layout>
                                    </ItemsRepeater>
                                </ScrollView>
                            </controls1:DropZone>
                        </Grid>
                    </StackPanel>
                    <StackPanel Grid.Column="2">
                        <TextBlock Text="Logos"
                                   Margin="0,0,0,8" />
                        <Grid Margin="0,0,0,8">
                            <controls:Shimmer MinHeight="168"
                                              Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
                            <controls1:DropZone Padding="16"
                                                MinHeight="168"
                                                DropMessage="Drop Images"
                                                AcceptedExtensions="png, jpg, jpeg, gif, webp"
                                                FilesDropped="DropZone_LogoFilesDropped"
                                                Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                                <ScrollView>
                                    <ItemsRepeater ItemsSource="{x:Bind ViewModel.MediaContext.Logos, Mode=OneWay}"
                                                   ItemTemplate="{StaticResource MeadiaTemplateSelector}">
                                        <ItemsRepeater.Layout>
                                            <StackLayout Spacing="16"
                                                         Orientation="Horizontal" />
                                        </ItemsRepeater.Layout>
                                    </ItemsRepeater>
                                </ScrollView>
                            </controls1:DropZone>
                        </Grid>
                    </StackPanel>
                </Grid>
                <StackPanel>
                    <TextBlock Text="Heros"
                               Margin="0,0,0,8" />
                    <Grid Margin="0,0,0,8">
                        <controls:Shimmer MinHeight="168"
                                          Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
                        <controls1:DropZone Padding="16"
                                            MinHeight="168"
                                            DropMessage="Drop Images"
                                            AcceptedExtensions="png, jpg, jpeg, gif, webp"
                                            FilesDropped="DropZone_HeroFilesDropped"
                                            Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                            <ScrollView>
                                <ItemsRepeater ItemsSource="{x:Bind ViewModel.MediaContext.Heros, Mode=OneWay}"
                                               ItemTemplate="{StaticResource MeadiaTemplateSelector}">
                                    <ItemsRepeater.Layout>
                                        <StackLayout Spacing="16"
                                                     Orientation="Horizontal" />
                                    </ItemsRepeater.Layout>
                                </ItemsRepeater>
                            </ScrollView>
                        </controls1:DropZone>
                    </Grid>
                </StackPanel>
            </StackPanel>
            <Grid Grid.Row="2"
                  MinHeight="32">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="auto" />
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                    <Button Height="38"
                            Padding="6"
                            ToolTipService.ToolTip="Apply Game"
                            Command="{x:Bind ViewModel.StageApplyCommand, Mode=OneWay}">
                        <SymbolIcon Symbol="Save" />
                    </Button>
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
</UserControl>
